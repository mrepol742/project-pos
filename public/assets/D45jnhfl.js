/**
 * Â© 2025 Melvin Jones Repol. All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{j as e,r as t}from"./Cn32OB1o.js";import{F as s,o as r,p as n,m as o,q as a,r as i,s as l,t as d,a as c,c as u}from"./CMJEcyR7.js";import{y as h}from"./InIMjYBq.js";import{P as m}from"./uZNeay-J.js";import{g as p,W as x,X as y,h as j,Y as f,a as g,d as b,u as w,o as v,p as S,D as N,Z as M,_ as P,$ as k,q,s as R,a0 as C,G as E,H as D,i as F,j as T,k as L,l as _,m as I,n as H,b as A,z as W,v as z,w as Q}from"./C6Ar4aP7.js";import{C as O}from"./DDb4eveY.js";import{a as $}from"./DyGPnA2_.js";import{u as G}from"./DQcpn1Ea.js";import{A as J}from"./CxTRSNhW.js";import{t as X}from"./nJrICC0Q.js";import"./Dph47E3T.js";import"./BeLtu-UY.js";import"./CFrBDmKk.js";import"./CGa6wk7G.js";import"./k-NSAY8B.js";import"./DLoPGEpw.js";import"./Bud0EmM2.js";import"./DnE_tpiE.js";import"./Ds-FckBC.js";import"./CZHQSwml.js";import"./Bn0FtMhX.js";import"./DXfOt1-V.js";import"./BPEPcvPN.js";import"./Dg4gVdE3.js";import"./BUTH-fPQ.js";import"./CR30QrPc.js";import"./BFlcZtwJ.js";import"./BPjVUy-D.js";import"./BTvahscA.js";import"./BXEMiIsG.js";import"./t8mI9RYm.js";import"./DUYG9vXX.js";import"./DKQ8yKpg.js";import"./Ca9hs0uL.js";import"./hqVdLbZn.js";import"./D0N3IP90.js";const B=({data:t})=>{const{showDeleteModal:s,setShowDeleteModal:r,products:n,setProducts:o,selectedProduct:a,setSelectedProduct:i,deleteMode:l}=t;return e.jsx(e.Fragment,{children:e.jsxs(p,{alignment:"center",scrollable:!0,visible:s,onClose:()=>r(!1),"aria-labelledby":"Confirm Delete?",children:[e.jsx(x,{children:e.jsx(y,{id:"LiveDemoExampleLabel",children:"Confirm Delete?"})}),e.jsxs(j,{children:["Woohoo, confirm to delete ",a.length," items?"]}),e.jsx(f,{children:e.jsx(g,{color:"primary",onClick:()=>{if(0===a.length)return alert("Select a product");o("void"===l?e=>e.filter((e=>!a.includes(e.date))):e=>e.map((e=>a.includes(e.date)?{...e,deleted:!0}:e))),i([]),r(!1)},children:"Save changes"})})]})})};B.propTypes={data:m.shape({showDeleteModal:m.bool.isRequired,setShowDeleteModal:m.func.isRequired,products:m.array.isRequired,setProducts:m.func.isRequired,selectedProduct:m.array.isRequired,setSelectedProduct:m.func.isRequired,deleteMode:m.string.isRequired}).isRequired};const K=({data:n})=>{const{showQuantityModal:o,setShowQuantityModal:a,products:i,setProducts:l,selectedProduct:d,setSelectedProduct:c}=n,u=t.useRef(null),[h,m]=t.useState(0),x=()=>{l((e=>e.map((e=>d.includes(e.date)?{...e,quantity:h}:e)))),c([]),a(!1)},y=e=>{"Enter"===e.key&&o&&x()};return t.useEffect((()=>{var e;o&&m(null==(e=i.find((e=>d.includes(e.date))))?void 0:e.quantity)}),[o]),t.useEffect((()=>(window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)})),[]),e.jsx(e.Fragment,{children:e.jsx(p,{alignment:"center",scrollable:!0,visible:o,onClose:()=>{m(0),a(!1)},"aria-labelledby":"Quantity Input",children:e.jsxs(j,{children:[e.jsx(b,{type:"number",id:"quantity",placeholder:"Enter quantity",value:h,min:1,max:999,onChange:e=>m(e.target.value),ref:u}),e.jsxs("div",{className:"numpad",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px",marginTop:"15px"},children:[[1,2,3,4,5,6,7,8,9].map(((t,s)=>e.jsx(g,{color:"primary",onClick:()=>m((e=>(e||"")+t)),style:{height:"50px"},children:t},t))),e.jsx(g,{color:"outline-danger",onClick:()=>m(""),style:{height:"50px"},children:"C"}),e.jsx(g,{color:"outline-primary",onClick:()=>m((e=>parseInt(e+"0"))),style:{height:"50px"},children:"0"}),e.jsx(g,{color:"outline-danger",onClick:()=>m((e=>e&&e.toString().slice(0,-1)||"")),style:{height:"50px"},children:e.jsx(s,{icon:r})})]}),e.jsx("div",{className:"d-flex justify-content-end mt-3 gap-2",children:e.jsx(g,{color:"primary",onClick:x,children:"Save changes"})})]})})})};K.propTypes={data:m.shape({showQuantityModal:m.bool.isRequired,setShowQuantityModal:m.func.isRequired,products:m.array.isRequired,setProducts:m.func.isRequired,selectedProduct:m.array.isRequired,setSelectedProduct:m.func.isRequired}).isRequired};const U=({data:n})=>{const{showDiscountModal:o,setShowDiscountModal:a,products:i,setProducts:l,selectedProduct:d,setSelectedProduct:c,discount:u,setDiscount:m}=n,[x,y]=t.useState(""),f=()=>x<0?h.error("Discount cannot be negative"):x>100?h.error("Discount cannot be more than 100%"):(d.length>0?l((e=>e.map((e=>d.includes(e.date)?{...e,discount:x}:e)))):m(x),c([]),void a(!1)),w=e=>{"Enter"===e.key&&o&&f()};return t.useEffect((()=>{var e;o&&y((null==(e=i.find((e=>d.includes(e.date))))?void 0:e.discount)||u||"")}),[o]),t.useEffect((()=>(window.addEventListener("keydown",w),()=>{window.removeEventListener("keydown",w)})),[]),e.jsx(e.Fragment,{children:e.jsx(p,{alignment:"center",scrollable:!0,visible:o,onClose:()=>{y(0),a(!1)},"aria-labelledby":"Discount Input",children:e.jsxs(j,{children:[e.jsx(b,{type:"number",id:"discount",placeholder:"Enter discount",value:x,onChange:e=>y(e.target.value)}),e.jsxs("div",{className:"numpad",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px",marginTop:"15px"},children:[e.jsx(g,{color:"primary",onClick:()=>y(20),style:{height:"50px"},children:"Senior"}),e.jsx(g,{color:"primary",onClick:()=>y(20),style:{height:"50px"},children:"PWD"}),e.jsx(g,{color:"primary",onClick:()=>y(30),style:{height:"50px"},children:"Employee"}),[1,2,3,4,5,6,7,8,9].map(((t,s)=>e.jsx(g,{color:"outline-primary",onClick:()=>y((e=>parseInt(e+""+t))),style:{height:"50px"},children:t},t))),e.jsx(g,{color:"outline-danger",onClick:()=>y(""),style:{height:"50px"},children:"C"}),e.jsx(g,{color:"outline-primary",onClick:()=>y((e=>parseInt(e+"0"))),style:{height:"50px"},children:"0"}),e.jsx(g,{color:"outline-danger",onClick:()=>y((e=>e&&e.toString().slice(0,-1)||"")),style:{height:"50px"},children:e.jsx(s,{icon:r})})]}),e.jsx("div",{className:"d-flex justify-content-end mt-3 gap-2",children:e.jsx(g,{color:"primary",onClick:f,children:"Save changes"})})]})})})};U.propTypes={data:m.shape({showDiscountModal:m.bool.isRequired,setShowDiscountModal:m.func.isRequired,products:m.array.isRequired,setProducts:m.func.isRequired,selectedProduct:m.array.isRequired,setSelectedProduct:m.func.isRequired,discount:m.number.isRequired,setDiscount:m.func.isRequired}).isRequired};const Y=({data:s})=>{const{showPaymentModal:r,setShowPaymentModal:n,products:o,setProducts:a,selectedProduct:i,setSelectedProduct:l,getTotal:d,paymentMethod:c,setPaymentMethod:u,discount:m,setDiscount:x}=s,[y,f]=t.useState(o.amount||""),w=d(),v=e=>{"Enter"===e.key&&r&&S()},S=async()=>0===o.length?h.error("Select a product"):y<0?h.error("Amount cannot be negative"):parseInt(y)<parseInt(w)?h.error("Amount is less than total"):parseInt(y)>Number.MAX_SAFE_INTEGER?h.error("Amount is greater than max safe integer"):void axios.post("/sales/checkout",{products:o,total:w,discount:m,total_items:o.reduce(((e,t)=>e+(t.quantity||1)),0),total_discount:0,total_taxes:0,total_payment:y,total_change:y-w,mode_of_payment:c,reference_number:"12"}).then((e=>{if(e.data.error)return h.error(e.data.error);if(200===e.status){a([]),l([]),n(!1),x(0),u("cash"),f(""),h.success("Checkout successful");try{const t=new WebSocket("ws://localhost:8080");t.onopen=()=>{console.log("Connected to print server"),t.send(JSON.stringify(e.data))},t.onmessage=e=>{console.log("Server says:",e.data);const s=JSON.parse(e.data);"success"!==s.status&&h.error("Failed to print receipt"),s.error&&console.error(s.error),t.close()},t.onerror=e=>{h.error("Error connecting to print server"),console.error("WebSocket error:",e)}}catch(t){}}})).catch((e=>{console.error(e),h.error("Checkout failed")}));return t.useEffect((()=>(window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)})),[]),e.jsx(e.Fragment,{children:e.jsx(p,{alignment:"center",scrollable:!0,visible:r,onClose:()=>{f(""),n(!1)},"aria-labelledby":"Payment",children:e.jsxs(j,{children:[e.jsx("h5",{children:"Payment"}),e.jsxs("div",{className:"d-flex flex-row justify-content-between gap-2 mb-3",children:[e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("cash"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("cash"),style:{cursor:"pointer"},children:"Cash"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("credit"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("credit"),style:{cursor:"pointer"},children:"Credit"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("debit"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("debit"),style:{cursor:"pointer"},children:"Debit"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("check"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("check"),style:{cursor:"pointer"},children:"Check"})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("p",{children:"Total:"}),e.jsx("div",{className:"text-wrap text-break overflow-y",children:w.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("p",{className:"my-auto",children:"Paid:"}),e.jsx(b,{type:"number",value:y,onChange:e=>{let t=e.target.value;t.length>1&&t.startsWith("0")&&(t=t.replace(/^0+/,"")),(""===t||Number(t)<=Number.MAX_SAFE_INTEGER)&&f(t)},placeholder:"Enter amount",min:0,max:Number.MAX_SAFE_INTEGER,className:"w-50"})]}),e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("p",{className:"me-3",children:"Change:"}),e.jsx("div",{className:"text-wrap text-break overflow-y",children:(()=>{const t=parseFloat(y),s=parseFloat(w);return t>=s?e.jsx(e.Fragment,{children:(t-s).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}):"0.00"})()})]}),e.jsx("div",{className:"d-flex justify-content-end mt-3 gap-2",children:e.jsx(g,{color:"primary",onClick:S,disabled:!y||parseInt(y)<parseInt(w)||parseInt(y)>Number.MAX_SAFE_INTEGER,children:"Print Receipt"})})]})})})};Y.propTypes={data:m.shape({showPaymentModal:m.bool.isRequired,setShowPaymentModal:m.func.isRequired,products:m.array.isRequired,setProducts:m.func.isRequired,selectedProduct:m.array.isRequired,setSelectedProduct:m.func.isRequired,getTotal:m.func.isRequired,paymentMethod:m.string.isRequired,setPaymentMethod:m.func.isRequired,discount:m.any.isRequired,setDiscount:m.func.isRequired}).isRequired};const V=({data:s})=>{const{showSearchModal:r,setShowSearchModal:n,products:o,setProducts:a,searchQuery:i}=s,[l,d]=t.useState(i||""),[c,u]=t.useState([]),[m,x]=t.useState(1),[y,f]=t.useState(0),[w,v]=t.useState(!1);t.useEffect((()=>{S(i)}),[]);const S=e=>{""!==e.trim()&&(v(!0),axios.post("/products/search",{query:e}).then((e=>e.data.error?h.error(e.data.error):0===e.data.data.length?h.error("No products found"):(u(e.data.data),x(e.data.currentPage),void f(e.data.totalPages)))).catch((e=>{console.error("Error fetching products:",e)})).finally((()=>{v(!1)})))};return e.jsx(e.Fragment,{children:e.jsx(p,{alignment:"center",scrollable:!0,visible:r,onClose:()=>{d(""),u([]),x(1),f(0),n(!1)},"aria-labelledby":"Search",children:e.jsxs(j,{children:[e.jsx(b,{type:"text",placeholder:"Search...",value:l||i,onChange:e=>{d(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&S(e.target.value)}}),e.jsx("div",{className:"d-flex justify-content-end mt-3",children:e.jsx(g,{color:"primary",onClick:()=>S(l),children:"Search"})}),w?e.jsx("div",{className:"d-flex justify-content-center align-items-center mt-3",children:e.jsx("h5",{children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsx("h5",{children:"Search results:"}),e.jsx("ul",{children:c.map((t=>e.jsxs("li",{children:[t.name," - ",t.cost_price]},t.id)))})]})]})})})};V.propTypes={data:m.shape({showSearchModal:m.bool.isRequired,setShowSearchModal:m.func.isRequired,products:m.array.isRequired,setProducts:m.func.isRequired,searchQuery:m.string.isRequired}).isRequired};const Z=({data:t})=>{const{showCalendarModal:s,setShowCalendarModal:r}=t;return e.jsx(e.Fragment,{children:e.jsx(p,{alignment:"center",scrollable:!0,visible:s,onClose:()=>r(!1),"aria-labelledby":"Calendar Modal",children:e.jsx(j,{children:e.jsx(O,{})})})})};Z.propTypes={data:m.shape({showCalendarModal:m.bool.isRequired,setShowCalendarModal:m.func.isRequired}).isRequired};const ee=({data:t})=>{const{showHelpModal:s,setShowHelpModal:r}=t;return e.jsx(e.Fragment,{children:e.jsx(p,{alignment:"center",scrollable:!0,visible:s,onClose:()=>r(!1),"aria-labelledby":"Help Modal",children:e.jsx(j,{children:"Hello World"})})})};ee.propTypes={data:m.shape({showHelpModal:m.bool.isRequired,setShowHelpModal:m.func.isRequired}).isRequired};const te=({data:r})=>{const{handleDelete:c,handleQuantity:u,handleNewSale:h,handleDiscount:m,handleSalesLock:p,handlePayment:x,salesLock:y,selectedProduct:j,showMenu:f,setShowMenu:g,discount:b,getDiscount:C,paymentMethod:E,setPaymentMethod:D,setShowCalendarModal:F,getSubTotal:T,getTotalTaxes:L,getTotal:_}=r,[I,H]=t.useState(!1),[A,W]=t.useState(new Date),{colorMode:z,setColorMode:Q}=w("coreui-free-react-admin-template-theme");t.useEffect((()=>{const e=setInterval((()=>{W(new Date)}),1e3);return()=>clearInterval(e)}),[]),t.useEffect((()=>{const e=e=>{"F11"===e.key&&(e.preventDefault(),O())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[I]);const O=()=>{if(!I)return document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),void H(!0);document.exitFullscreen&&document.exitFullscreen(),H(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-grow-1 text-uppercase","data-aos":"fade-in",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center p-2 text-center",children:[e.jsxs("div",{onClick:()=>F(!0),children:[e.jsx(s,{icon:n,className:"me-1"}),A.toLocaleString("en-PH",{month:"long",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})]}),e.jsxs("div",{children:[e.jsxs(v,{children:[e.jsx(S,{caret:!1,children:"dark"===z?e.jsx(N,{icon:M,size:"lg"}):"auto"===z?e.jsx(N,{icon:P,size:"lg"}):e.jsx(N,{icon:k,size:"lg"})}),e.jsxs(q,{children:[e.jsxs(R,{active:"light"===z,className:"d-flex align-items-center",as:"button",type:"button",onClick:()=>Q("light"),children:[e.jsx(N,{className:"me-2",icon:k,size:"lg"})," Light"]}),e.jsxs(R,{active:"dark"===z,className:"d-flex align-items-center",as:"button",type:"button",onClick:()=>Q("dark"),children:[e.jsx(N,{className:"me-2",icon:M,size:"lg"})," Dark"]}),e.jsxs(R,{active:"auto"===z,className:"d-flex align-items-center",as:"button",type:"button",onClick:()=>Q("auto"),children:[e.jsx(N,{className:"me-2",icon:P,size:"lg"})," Auto"]})]})]}),e.jsx(s,{icon:o,onClick:()=>g(!f),style:{cursor:"pointer"}}),e.jsx(s,{className:"ms-3",icon:I?a:i,onClick:O,style:{cursor:"pointer"},title:I?"Exit Full Screen":"Full Screen"})]})]}),e.jsxs("div",{className:" d-flex justify-content-between align-items-center text-center",children:[e.jsxs("div",{className:" rounded py-4 m-1 d-flex flex-column align-items-center border border-2 "+(j.length>0?"bg-danger border-danger":"border-secondary"),onClick:e=>c("del"),style:{flex:1},children:[e.jsx("span",{className:"fs-2",children:"DEL"}),"Cancel"]}),e.jsxs("div",{className:"rounded py-4 m-1 d-flex flex-column align-items-center border border-2 border-secondary",onClick:u,style:{flex:1},children:[e.jsx("span",{className:"fs-2",children:"F4"}),"Quantity"]}),e.jsxs("div",{className:"rounded py-4 m-1 d-flex flex-column align-items-center border border-2 border-secondary",onClick:h,style:{flex:1},children:[e.jsx("span",{className:"fs-2",children:"F5"}),"New Sale"]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center text-center",children:[e.jsxs("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 "+(C()>0?"bg-primary border-primary":"border-secondary"),onClick:m,style:{flex:1},children:[e.jsx("span",{className:"fs-2",children:"F2"}),"Discount"]}),e.jsxs("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 "+(y?"bg-danger border-danger":"border-secondary"),onClick:p,style:{flex:1},children:[e.jsx(s,{icon:y?l:d,style:{width:"30px",height:"50px"}})," ",y?"Unlock":"Lock"]}),e.jsxs("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-success bg-success",onClick:x,style:{flex:1},children:[e.jsx("span",{className:"fs-2",children:"F10"}),"Payment"]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 text-center",children:[e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-secondary bg-secondary",style:{flex:1},children:"Refund"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-secondary bg-secondary",style:{flex:1},children:"Transfer"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-danger bg-danger",onClick:e=>c("void"),style:{flex:1},children:"Void"})]}),j.length>0&&e.jsxs("div",{className:"ms-1",children:[j.length," Items selected"]})]}),e.jsx("div",{className:"mt-auto text-uppercase","data-aos":"fade-in",children:e.jsxs("div",{className:"bg-body-secondary p-3 my-3 rounded mt-auto",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:T().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),b>0&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:[b,"%"]})]}),e.jsxs("div",{className:"d-flex justify-content-between  border-bottom border-secondary pb-2",children:[e.jsx("span",{children:"Tax:"}),e.jsx("span",{children:L().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-2",children:[e.jsx("strong",{children:"Total:"}),e.jsx("strong",{children:_().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]})]})})]})};te.propTypes={data:m.shape({handleDelete:m.func.isRequired,handleQuantity:m.func.isRequired,handleNewSale:m.func.isRequired,handleDiscount:m.func.isRequired,handleSalesLock:m.func.isRequired,handlePayment:m.func.isRequired,salesLock:m.bool.isRequired,selectedProduct:m.array.isRequired,showMenu:m.bool.isRequired,setShowMenu:m.func.isRequired,discount:m.number.isRequired,getDiscount:m.func.isRequired,paymentMethod:m.string.isRequired,setPaymentMethod:m.func.isRequired,setShowCalendarModal:m.func.isRequired,getSubTotal:m.func.isRequired,getTotalTaxes:m.func.isRequired,getTotal:m.func.isRequired}).isRequired};const se=({data:r})=>{const{showMenu:n,setShowMenu:o,popupMenu:a,setPopupMenu:i,showPopupMenu:l,setShowPopupMenu:d}=r,h=$((e=>e.user)),m=G(),p=[{name:"Sales History",path:"/history",icon:u},{name:"Open Sales",path:"/open-sales",icon:u},{name:"Cash In/Out",path:"/cash-in-out",icon:u},{name:"End of Day",path:"/eod",icon:u},{name:"User Info",path:"/user-info",icon:u}];return t.useEffect((()=>{const e=e=>{console.log(e.key),"Escape"===e.key&&o(!1)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[]),e.jsxs("div",{className:"m-2","data-aos":"fade-in",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",style:{cursor:"pointer"},onClick:()=>o(!1),children:[e.jsxs("div",{className:"text-center py-3",onClick:()=>o(!1),children:[e.jsx(s,{icon:c,className:"my-auto me-3"}),e.jsx("span",{className:"text-uppercase",children:"Back"})]}),e.jsx("span",{onClick:e=>m("/logout"),children:"Logout"})]}),e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center mb-3 text-center",children:[e.jsx("div",{className:"rounded-pill bg-primary d-flex align-items-center justify-content-center fs-2",style:{width:"80px",height:"80px",color:"white"},children:(x=h.name,x?x.charAt(0).toUpperCase():"")}),e.jsx("h2",{className:"mt-2 mb-0",children:h.name}),e.jsx("p",{className:"mb-0",children:h.username})]}),e.jsx(C,{children:p.map(((t,r)=>e.jsx(E,{children:e.jsx(D,{children:e.jsxs("span",{className:"border p-3 rounded",style:{display:"flex",alignItems:"center",gap:"8px"},onClick:()=>{i(t.path),o(!1),d(!0)},children:[e.jsx(s,{icon:t.icon,className:"my-auto"}),e.jsx("span",{children:t.name})]})})},r)))})]});var x};se.propTypes={data:m.shape({showMenu:m.bool.isRequired,setShowMenu:m.func.isRequired,popupMenu:m.string.isRequired,setPopupMenu:m.func.isRequired,showPopupMenu:m.bool.isRequired,setShowPopupMenu:m.func.isRequired}).isRequired};const re=({data:s})=>{const{popupMenu:r,setPopupMenu:n,showPopupMenu:o,setShowPopupMenu:a}=s,[i,l]=t.useState([]),[d,c]=t.useState(1),[u,h]=t.useState(0);return t.useEffect((()=>{o&&(async()=>{try{axios.get("/sales-history").then((e=>{l(e.data.data),h(e.data.totalPages),c(e.data.currentPage)})).catch((e=>{console.error("Error fetching sales history:",e)}))}catch(e){console.error("Error fetching sales history:",e)}})()}),[]),e.jsx(e.Fragment,{children:e.jsxs(p,{fullscreen:!0,alignment:"center",scrollable:!0,visible:o,onClose:()=>a(!1),"aria-labelledby":"Help Modal",children:[e.jsx(x,{className:"border-0"}),e.jsxs(j,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{children:"Your Today's Sales History"}),e.jsx(g,{color:"primary",children:"Export"})]}),0===i.length?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("h3",{children:"Loading sales..."})}):e.jsxs(e.Fragment,{children:[e.jsxs(F,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx(T,{children:e.jsxs(L,{children:[e.jsx(_,{scope:"col",children:"#"}),e.jsx(_,{scope:"col",children:"Amount"}),e.jsx(_,{scope:"col",children:"Discount"}),e.jsx(_,{scope:"col",children:"Payment"}),e.jsx(_,{scope:"col",children:"Reference Number"}),e.jsx(_,{scope:"col"}),e.jsx(_,{scope:"col"})]})}),e.jsx(I,{children:i.map(((t,s)=>e.jsxs(L,{children:[e.jsx(H,{children:t.id}),e.jsx(H,{children:t.total}),e.jsx(H,{children:t.total_discount.toLocaleString()}),e.jsx(H,{children:t.mode_of_payment}),e.jsx(H,{children:t.reference_number}),e.jsx(H,{children:X(t.created_at)}),e.jsx(H,{children:e.jsx(g,{color:"primary",size:"sm",children:"Print"})})]},t.id)))})]}),e.jsx(J,{currentPage:d,setCurrentPage:c,totalPages:u,setTotalPages:h})]})]})]})})};re.propTypes={data:m.shape({popupMenu:m.string.isRequired,setPopupMenu:m.func.isRequired,showPopupMenu:m.bool.isRequired,setShowPopupMenu:m.func.isRequired}).isRequired};const ne=({data:t})=>{const{popupMenu:s,setPopupMenu:r,showPopupMenu:n,setShowPopupMenu:o}=t;return e.jsx(e.Fragment,{children:e.jsxs(p,{alignment:"center",scrollable:!0,visible:n,onClose:()=>o(!1),"aria-labelledby":"Help Modal",children:[e.jsx(x,{className:"border-0",children:e.jsx(y,{className:"text-center",children:"End of Day"})}),e.jsxs(j,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"d-block",children:"Are you sure you want to end the day?"}),e.jsx("span",{children:"All sales will be finalized and no further transactions can be made."})]}),e.jsx(b,{className:"mt-3",type:"text",placeholder:"Enter the cash drawer amount","aria-label":"Cash drawer amount"}),e.jsx(g,{className:"mt-3",color:"primary",onClick:()=>{o(!1),r("")},children:"Confirm End of Day"})]})]})})};ne.propTypes={data:m.shape({popupMenu:m.string.isRequired,setPopupMenu:m.func.isRequired,showPopupMenu:m.bool.isRequired,setShowPopupMenu:m.func.isRequired}).isRequired};const oe=()=>{const[s,r]=t.useState([]),[n,o]=t.useState([]),[a,i]=t.useState(null),[l,d]=t.useState(""),[c,u]=t.useState(!1),[m,p]=t.useState(!1),[x,y]=t.useState(!1),[j,f]=t.useState(!1),[g,w]=t.useState(!1),[v,S]=t.useState(!1),[N,M]=t.useState(!1),[P,k]=t.useState(!1),[q,R]=t.useState("cash"),[C,E]=t.useState(!1),[D,O]=t.useState(0),[$,G]=t.useState(!1),[J,X]=t.useState(null),[oe,ae]=t.useState(!1),[ie,le]=t.useState(""),[de,ce]=t.useState(!1),ue=()=>s.filter((e=>"discount"!==e.id&&!e.deleted)).reduce(((e,t)=>e+t.sale_price*(1-t.discount/100)*t.quantity),0),he=()=>s.filter((e=>!e.deleted)).reduce(((e,t)=>{const s=t.sale_price*(1-t.discount/100);return e+(t.taxes?s*t.taxes/100:0)*t.quantity}),0).toFixed(2),me=()=>(parseFloat(ue())+parseFloat(he()))*(1-parseFloat(D)/100),pe=(e,t,s=0)=>e*(1-s/100)*t,xe=(e,t=0)=>e*(1-t/100),ye=e=>{const t=[{condition:"F1"===e.key,action:()=>M(!0)},{condition:"F2"===e.key,action:fe},{condition:"F4"===e.key,action:je},{condition:"F10"===e.key,action:we},{condition:"Delete"===e.key,action:ge},{condition:"F5"===e.key,action:be},{condition:e.ctrlKey&&"h"===e.key.toLowerCase(),action:()=>k(!0)}];for(const{condition:s,action:r}of t)if(s){e.preventDefault(),u(!1),p(!1),y(!1),f(!1),w(!1),S(!1),M(!1),k(!1),r();break}};t.useEffect((()=>{const e=e=>{if($)return e.preventDefault(),e.returnValue="",""};return window.addEventListener("beforeunload",e),window.addEventListener("keydown",ye),()=>{window.removeEventListener("keydown",ye),window.removeEventListener("beforeunload",e)}}),[$]),t.useEffect((()=>{let e;(async()=>{axios.get("/sales-lock").then((e=>{if(e.data.error)return h.error(e.data.error);e.data.length>0?(i(!0),r(JSON.parse(e.data))):i(!1)})).catch((e=>{console.error("Error fetching sales lock:",e)}))})();const t=()=>{ae(!1),clearTimeout(e),e=setTimeout((()=>{ae(!0)}),6e4)};return e=setTimeout((()=>{ae(!0)}),6e4),window.addEventListener("mousemove",t),window.addEventListener("keydown",t),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("keydown",t),clearTimeout(e)}}),[]);const je=()=>a?h.error("Sales locked"):0===n.length?h.error("Select a product"):void p(!0),fe=()=>a?h.error("Sales locked"):0===s.length?h.error("No products in cart"):void y(!0),ge=e=>a?h.error("Sales locked"):0===n.length?h.error("Select a product"):(u(!0),void X(e)),be=()=>a?h.error("Sales locked"):0===s.length?h.error("No products in cart"):(r([]),void o([])),we=()=>a?h.error("Sales locked"):0===s.length?h.error("No products in cart"):void S(!0);return null===a?e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(A,{color:"primary"})}):e.jsxs("div",{className:"d-flex flex-column",style:{height:"100vh",width:"99.3%",position:"relative"},children:[oe&&e.jsx("div",{style:{zIndex:9e3,position:"fixed",top:0,left:0,height:"100vh",width:"100vw",background:"#fff"},children:e.jsx(W,{src:"/images/banner.jpg",className:"img-fluid",alt:"Banner",style:{width:"100vw",height:"100vh",objectFit:"cover"}})}),"/history"===ie&&e.jsx(re,{data:{showPopupMenu:de,setShowPopupMenu:ce}}),"/eod"===ie&&e.jsx(ne,{data:{showPopupMenu:de,setShowPopupMenu:ce}}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:0,pointerEvents:"none",color:"#000",letterSpacing:"0.1em",userSelect:"none",whiteSpace:"nowrap",textAlign:"center"},children:[e.jsx("span",{style:{fontSize:"4vw",fontWeight:700,opacity:.08},children:"Project POS"}),e.jsx("span",{className:"d-block",style:{opacity:.2},children:"https://mrepol742.github.io"})]}),e.jsx(B,{data:{showDeleteModal:c,setShowDeleteModal:u,products:s,setProducts:r,selectedProduct:n,setSelectedProduct:o,deleteMode:J}}),e.jsx(K,{data:{showQuantityModal:m,setShowQuantityModal:p,products:s,setProducts:r,selectedProduct:n,setSelectedProduct:o}}),e.jsx(U,{data:{showDiscountModal:x,setShowDiscountModal:y,products:s,setProducts:r,selectedProduct:n,setSelectedProduct:o,discount:D,setDiscount:O}}),e.jsx(Y,{data:{showPaymentModal:v,setShowPaymentModal:S,products:s,setProducts:r,selectedProduct:n,setSelectedProduct:o,getTotal:me,paymentMethod:q,setPaymentMethod:R,discount:D,setDiscount:O}}),e.jsx(V,{data:{showSearchModal:g,setShowSearchModal:w,products:s,setProducts:r,searchQuery:l}}),e.jsx(Z,{data:{showCalendarModal:N,setShowCalendarModal:M}}),e.jsx(ee,{data:{showHelpModal:P,setShowHelpModal:k}}),e.jsxs(z,{className:"flex-grow-1 overflow-hidden",children:[e.jsxs(Q,{className:"d-flex flex-column h-100 pe-0",children:[e.jsx(b,{className:"rounded-0 py-3 border-0 border-bottom",type:"search",placeholder:"Search product by name or barcode","aria-label":"Search",value:l,onChange:e=>{d(e.target.value)},autoFocus:!0,onFocus:e=>{e.target.select(),e.target.setSelectionRange(0,e.target.value.length)},onKeyDown:e=>{"Enter"===e.key&&((e=>{if(a)return h.error("Sales locked");const t=e.target.value;if(t.includes(" "))return d(t),w(!0);if(s.find((e=>e.barcode&&e.barcode.toLowerCase()===t&&0===e.discount)))return r((e=>e.map((e=>e.barcode&&e.barcode.toLowerCase()===t?{...e,quantity:e.quantity+1}:e)))),void G(!0);axios.get(`/products/${t}`).then((e=>{if(e.data.error)return h.error(e.data.error);if(!e.data.id)return h.error("Product not found");const t=e.data;r((e=>e.find((e=>e.id===t.id&&0===e.discount))?e.map((e=>e.id===t.id?{...e,quantity:e.quantity+1,discount:0}:e)):[...e,{...t,quantity:1,discount:0,date:Date.now()}])),G(!0)})).catch((e=>{console.error("Error searching products:",e)}))})(e),e.target.value.includes(" ")||(e.target.value="",d("")))}}),e.jsx("div",{className:"flex-grow-1 overflow-auto",style:{minHeight:0},children:e.jsxs(F,{hover:!0,responsive:!0,children:[e.jsx(T,{children:e.jsxs(L,{children:[e.jsx(_,{scope:"col",className:"text-uppercase",style:{width:50,maxWidth:80},children:"QTY"}),e.jsx(_,{scope:"col",className:"text-uppercase",style:{minWidth:180},children:"Item"}),e.jsx(_,{scope:"col",className:"text-uppercase text-end",style:{width:100,maxWidth:120},children:"Price"}),e.jsx(_,{scope:"col",className:"text-uppercase text-end",style:{width:110,maxWidth:130},children:"Total"})]})}),0!==s.length&&e.jsx(I,{children:s.map(((t,s)=>{const r=t.taxes?t.sale_price+t.sale_price*t.taxes/100:t.sale_price;return e.jsxs(L,{active:n.includes(t.date),onClick:()=>(e=>{if(n.includes(e))return o(n.filter((t=>t!==e)));o([...n,e])})(t.date),children:[e.jsx(H,{className:`${t.deleted&&"text-danger"}`,style:{width:50,maxWidth:80},children:t.quantity}),e.jsxs(H,{style:{minWidth:180},children:[e.jsx("span",{className:`${t.deleted&&"text-danger"}`,children:t.name}),e.jsx("span",{className:(t.deleted?"text-danger":"text-muted")+" d-block",style:{fontSize:"0.7em"},children:t.barcode})]}),e.jsxs(H,{className:`${t.deleted&&"text-danger"} text-end`,style:{width:100,maxWidth:120},children:[xe(r,t.discount).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),t.discount>0&&e.jsx("div",{className:"d-block text-muted text-decoration-line-through",style:{fontSize:"0.7em"},children:xe(r,0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsx(H,{className:`${t.deleted&&"text-danger"} text-end`,style:{width:110,maxWidth:130},children:pe(r,t.quantity,t.discount).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]},s)}))})]})})]}),e.jsx(Q,{lg:5,xl:3,className:"d-flex flex-column border-start border-2 border-secondary h-100",children:C?e.jsx(se,{data:{showMenu:C,setShowMenu:E,popupMenu:ie,setPopupMenu:le,showPopupMenu:de,setShowPopupMenu:ce}}):e.jsx(te,{data:{handleDelete:ge,handleQuantity:je,handleNewSale:be,handleDiscount:fe,handleSalesLock:async()=>{if(0===s.length)return h.error("No products in cart");axios.post("/sales-lock",{products:a?"[]":JSON.stringify(s),mode:!a}).then((e=>{if(e.data.error)return h.error(e.data.error);h.success(a?"Sales unlocked successfully":"Sales locked successfully"),i(!a)})).catch((e=>{console.error("Error fetching sales lock:",e)}))},handlePayment:we,salesLock:a,selectedProduct:n,showMenu:C,setShowMenu:E,discount:D,getDiscount:()=>s.reduce(((e,t)=>e+(t.discount||0)),0),paymentMethod:q,setPaymentMethod:R,setShowCalendarModal:M,getSubTotal:ue,getTotalTaxes:he,getTotal:me}})})]})]})};export{oe as default};
