/**
 * Â© 2025 Melvin Jones Repol. All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{j as e,r as s}from"./Cn32OB1o.js";import{F as t,k as r,l as n,m as o,n as a,o as i,p as d,b as l,q as c,r as u,s as m,t as h,f as p}from"./CdjoWadd.js";import{y as x}from"./InIMjYBq.js";import{P as y}from"./uZNeay-J.js";import{g as j,Z as f,_ as g,h as b,$ as w,a as v,d as S,u as N,o as k,p as M,x as P,E as q,F as C,G as R,q as E,s as D,a0 as F,A as L,B as T,i as _,j as I,k as H,l as A,m as Q,n as W,b as z,N as $,R as O,S as G}from"./YAh4y49R.js";import{C as J}from"./DDb4eveY.js";import{a as B}from"./DyGPnA2_.js";import{u as X}from"./DQcpn1Ea.js";import{A as K}from"./CplxJx0S.js";import{t as U}from"./nJrICC0Q.js";import"./Dph47E3T.js";import"./BeLtu-UY.js";import"./CFrBDmKk.js";import"./CGa6wk7G.js";import"./k-NSAY8B.js";import"./DLoPGEpw.js";import"./Bud0EmM2.js";import"./DnE_tpiE.js";import"./Ds-FckBC.js";import"./CZHQSwml.js";import"./Bn0FtMhX.js";import"./DXfOt1-V.js";import"./BPEPcvPN.js";import"./Dg4gVdE3.js";import"./BUTH-fPQ.js";import"./NsnstyZI.js";import"./BFlcZtwJ.js";import"./BPjVUy-D.js";import"./BTvahscA.js";import"./BXEMiIsG.js";import"./t8mI9RYm.js";import"./DUYG9vXX.js";import"./DKQ8yKpg.js";import"./Ca9hs0uL.js";import"./hqVdLbZn.js";import"./D0N3IP90.js";const V=({data:s})=>{const{showDeleteModal:t,setShowDeleteModal:r,products:n,setProducts:o,selectedProduct:a,setSelectedProduct:i,deleteMode:d}=s;return e.jsx(e.Fragment,{children:e.jsxs(j,{alignment:"center",scrollable:!0,visible:t,onClose:()=>r(!1),"aria-labelledby":"Confirm Delete?",children:[e.jsx(f,{children:e.jsx(g,{id:"LiveDemoExampleLabel",children:"Confirm Delete?"})}),e.jsxs(b,{children:["Woohoo, confirm to delete ",a.length," items?"]}),e.jsx(w,{children:e.jsx(v,{color:"primary",onClick:()=>{if(0===a.length)return alert("Select a product");o("void"===d?e=>e.filter((e=>!a.includes(e.date))):e=>e.map((e=>a.includes(e.date)?{...e,deleted:!0}:e))),i([]),r(!1)},children:"Save changes"})})]})})};V.propTypes={data:y.shape({showDeleteModal:y.bool.isRequired,setShowDeleteModal:y.func.isRequired,products:y.array.isRequired,setProducts:y.func.isRequired,selectedProduct:y.array.isRequired,setSelectedProduct:y.func.isRequired,deleteMode:y.string.isRequired}).isRequired};const Y=({data:n})=>{const{showQuantityModal:o,setShowQuantityModal:a,products:i,setProducts:d,selectedProduct:l,setSelectedProduct:c}=n,u=s.useRef(null),[m,h]=s.useState(0),p=()=>{d((e=>e.map((e=>l.includes(e.date)?{...e,quantity:m}:e)))),c([]),a(!1)},x=e=>{"Enter"===e.key&&o&&p()};return s.useEffect((()=>{var e;o&&h(null==(e=i.find((e=>l.includes(e.date))))?void 0:e.quantity)}),[o]),s.useEffect((()=>(window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)})),[]),e.jsx(e.Fragment,{children:e.jsx(j,{alignment:"center",scrollable:!0,visible:o,onClose:()=>{h(0),a(!1)},"aria-labelledby":"Quantity Input",children:e.jsxs(b,{children:[e.jsx(S,{type:"number",id:"quantity",placeholder:"Enter quantity",value:m,min:1,max:999,onChange:e=>h(e.target.value),ref:u}),e.jsxs("div",{className:"numpad",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px",marginTop:"15px"},children:[[1,2,3,4,5,6,7,8,9].map(((s,t)=>e.jsx(v,{color:"primary",onClick:()=>h((e=>(e||"")+s)),style:{height:"50px"},children:s},s))),e.jsx(v,{color:"outline-danger",onClick:()=>h(""),style:{height:"50px"},children:"C"}),e.jsx(v,{color:"outline-primary",onClick:()=>h((e=>parseInt(e+"0"))),style:{height:"50px"},children:"0"}),e.jsx(v,{color:"outline-danger",onClick:()=>h((e=>e&&e.toString().slice(0,-1)||"")),style:{height:"50px"},children:e.jsx(t,{icon:r})})]}),e.jsx("div",{className:"d-flex justify-content-end mt-3 gap-2",children:e.jsx(v,{color:"primary",onClick:p,children:"Save changes"})})]})})})};Y.propTypes={data:y.shape({showQuantityModal:y.bool.isRequired,setShowQuantityModal:y.func.isRequired,products:y.array.isRequired,setProducts:y.func.isRequired,selectedProduct:y.array.isRequired,setSelectedProduct:y.func.isRequired}).isRequired};const Z=({data:n})=>{const{showDiscountModal:o,setShowDiscountModal:a,products:i,setProducts:d,selectedProduct:l,setSelectedProduct:c,discount:u,setDiscount:m}=n,[h,p]=s.useState(""),y=()=>h<0?x.error("Discount cannot be negative"):h>100?x.error("Discount cannot be more than 100%"):(l.length>0?d((e=>e.map((e=>l.includes(e.date)?{...e,discount:h}:e)))):m(h),c([]),void a(!1)),f=e=>{"Enter"===e.key&&o&&y()};return s.useEffect((()=>{var e;o&&p((null==(e=i.find((e=>l.includes(e.date))))?void 0:e.discount)||u||"")}),[o]),s.useEffect((()=>(window.addEventListener("keydown",f),()=>{window.removeEventListener("keydown",f)})),[]),e.jsx(e.Fragment,{children:e.jsx(j,{alignment:"center",scrollable:!0,visible:o,onClose:()=>{p(0),a(!1)},"aria-labelledby":"Discount Input",children:e.jsxs(b,{children:[e.jsx(S,{type:"number",id:"discount",placeholder:"Enter discount",value:h,onChange:e=>p(e.target.value)}),e.jsxs("div",{className:"numpad",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px",marginTop:"15px"},children:[e.jsx(v,{color:"primary",onClick:()=>p(20),style:{height:"50px"},children:"Senior"}),e.jsx(v,{color:"primary",onClick:()=>p(20),style:{height:"50px"},children:"PWD"}),e.jsx(v,{color:"primary",onClick:()=>p(30),style:{height:"50px"},children:"Employee"}),[1,2,3,4,5,6,7,8,9].map(((s,t)=>e.jsx(v,{color:"outline-primary",onClick:()=>p((e=>parseInt(e+""+s))),style:{height:"50px"},children:s},s))),e.jsx(v,{color:"outline-danger",onClick:()=>p(""),style:{height:"50px"},children:"C"}),e.jsx(v,{color:"outline-primary",onClick:()=>p((e=>parseInt(e+"0"))),style:{height:"50px"},children:"0"}),e.jsx(v,{color:"outline-danger",onClick:()=>p((e=>e&&e.toString().slice(0,-1)||"")),style:{height:"50px"},children:e.jsx(t,{icon:r})})]}),e.jsx("div",{className:"d-flex justify-content-end mt-3 gap-2",children:e.jsx(v,{color:"primary",onClick:y,children:"Save changes"})})]})})})};Z.propTypes={data:y.shape({showDiscountModal:y.bool.isRequired,setShowDiscountModal:y.func.isRequired,products:y.array.isRequired,setProducts:y.func.isRequired,selectedProduct:y.array.isRequired,setSelectedProduct:y.func.isRequired,discount:y.number.isRequired,setDiscount:y.func.isRequired}).isRequired};const ee=({data:t})=>{const{showPaymentModal:r,setShowPaymentModal:n,products:o,setProducts:a,selectedProduct:i,setSelectedProduct:d,getTotal:l,paymentMethod:c,setPaymentMethod:u,discount:m,setDiscount:h}=t,[p,y]=s.useState(o.amount||""),f=l(),g=e=>{"Enter"===e.key&&r&&w()},w=async()=>0===o.length?x.error("Select a product"):p<0?x.error("Amount cannot be negative"):parseInt(p)<parseInt(f)?x.error("Amount is less than total"):parseInt(p)>Number.MAX_SAFE_INTEGER?x.error("Amount is greater than max safe integer"):void axios.post("/sales/checkout",{products:o,total:f,discount:m,total_items:o.reduce(((e,s)=>e+(s.quantity||1)),0),total_discount:0,total_taxes:0,total_payment:p,total_change:p-f,mode_of_payment:c,reference_number:"12"}).then((e=>{if(e.data.error)return x.error(e.data.error);if(200===e.status){a([]),d([]),n(!1),h(0),u("cash"),y(""),x.success("Checkout successful");try{const s=new WebSocket("ws://localhost:8080");s.onopen=()=>{console.log("Connected to print server"),s.send(JSON.stringify(e.data))},s.onmessage=e=>{console.log("Server says:",e.data);const t=JSON.parse(e.data);"success"!==t.status&&x.error("Failed to print receipt"),t.error&&console.error(t.error),s.close()},s.onerror=e=>{x.error("Error connecting to print server"),console.error("WebSocket error:",e)}}catch(s){}}})).catch((e=>{console.error(e),x.error("Checkout failed")}));return s.useEffect((()=>(window.addEventListener("keydown",g),()=>{window.removeEventListener("keydown",g)})),[]),e.jsx(e.Fragment,{children:e.jsx(j,{alignment:"center",scrollable:!0,visible:r,onClose:()=>{y(""),n(!1)},"aria-labelledby":"Payment",children:e.jsxs(b,{children:[e.jsx("h5",{children:"Payment"}),e.jsxs("div",{className:"d-flex flex-row justify-content-between gap-2 mb-3",children:[e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("cash"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("cash"),style:{cursor:"pointer"},children:"Cash"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("credit"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("credit"),style:{cursor:"pointer"},children:"Credit"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("debit"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("debit"),style:{cursor:"pointer"},children:"Debit"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 flex-fill "+("check"===c?"bg-primary border-primary":"border-secondary"),onClick:()=>u("check"),style:{cursor:"pointer"},children:"Check"})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("p",{children:"Total:"}),e.jsx("div",{className:"text-wrap text-break overflow-y",children:f.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("p",{className:"my-auto",children:"Paid:"}),e.jsx(S,{type:"number",value:p,onChange:e=>{let s=e.target.value;s.length>1&&s.startsWith("0")&&(s=s.replace(/^0+/,"")),(""===s||Number(s)<=Number.MAX_SAFE_INTEGER)&&y(s)},placeholder:"Enter amount",min:0,max:Number.MAX_SAFE_INTEGER,className:"w-50"})]}),e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("p",{className:"me-3",children:"Change:"}),e.jsx("div",{className:"text-wrap text-break overflow-y",children:(()=>{const s=parseFloat(p),t=parseFloat(f);return s>=t?e.jsx(e.Fragment,{children:(s-t).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}):"0.00"})()})]}),e.jsx("div",{className:"d-flex justify-content-end mt-3 gap-2",children:e.jsx(v,{color:"primary",onClick:w,disabled:!p||parseInt(p)<parseInt(f)||parseInt(p)>Number.MAX_SAFE_INTEGER,children:"Print Receipt"})})]})})})};ee.propTypes={data:y.shape({showPaymentModal:y.bool.isRequired,setShowPaymentModal:y.func.isRequired,products:y.array.isRequired,setProducts:y.func.isRequired,selectedProduct:y.array.isRequired,setSelectedProduct:y.func.isRequired,getTotal:y.func.isRequired,paymentMethod:y.string.isRequired,setPaymentMethod:y.func.isRequired,discount:y.any.isRequired,setDiscount:y.func.isRequired}).isRequired};const se=({data:t})=>{const{showSearchModal:r,setShowSearchModal:n,products:o,setProducts:a,searchQuery:i}=t,[d,l]=s.useState(i||""),[c,u]=s.useState([]),[m,h]=s.useState(1),[p,y]=s.useState(0),[f,g]=s.useState(!1);s.useEffect((()=>{w(i)}),[]);const w=e=>{""!==e.trim()&&(g(!0),axios.post("/products/search",{query:e}).then((e=>e.data.error?x.error(e.data.error):0===e.data.data.length?x.error("No products found"):(u(e.data.data),h(e.data.currentPage),void y(e.data.totalPages)))).catch((e=>{console.error("Error fetching products:",e)})).finally((()=>{g(!1)})))};return e.jsx(e.Fragment,{children:e.jsx(j,{alignment:"center",scrollable:!0,visible:r,onClose:()=>{l(""),u([]),h(1),y(0),n(!1)},"aria-labelledby":"Search",children:e.jsxs(b,{children:[e.jsx(S,{type:"text",placeholder:"Search...",value:d||i,onChange:e=>{l(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&w(e.target.value)}}),e.jsx("div",{className:"d-flex justify-content-end mt-3",children:e.jsx(v,{color:"primary",onClick:()=>w(d),children:"Search"})}),f?e.jsx("div",{className:"d-flex justify-content-center align-items-center mt-3",children:e.jsx("h5",{children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsx("h5",{children:"Search results:"}),e.jsx("ul",{children:c.map((s=>e.jsxs("li",{children:[s.name," - ",s.cost_price]},s.id)))})]})]})})})};se.propTypes={data:y.shape({showSearchModal:y.bool.isRequired,setShowSearchModal:y.func.isRequired,products:y.array.isRequired,setProducts:y.func.isRequired,searchQuery:y.string.isRequired}).isRequired};const te=({data:s})=>{const{showCalendarModal:t,setShowCalendarModal:r}=s;return e.jsx(e.Fragment,{children:e.jsx(j,{alignment:"center",scrollable:!0,visible:t,onClose:()=>r(!1),"aria-labelledby":"Calendar Modal",children:e.jsx(b,{children:e.jsx(J,{})})})})};te.propTypes={data:y.shape({showCalendarModal:y.bool.isRequired,setShowCalendarModal:y.func.isRequired}).isRequired};const re=({data:s})=>{const{showHelpModal:t,setShowHelpModal:r}=s;return e.jsx(e.Fragment,{children:e.jsx(j,{alignment:"center",scrollable:!0,visible:t,onClose:()=>r(!1),"aria-labelledby":"Help Modal",children:e.jsx(b,{children:"Hello World"})})})};re.propTypes={data:y.shape({showHelpModal:y.bool.isRequired,setShowHelpModal:y.func.isRequired}).isRequired};const ne=({data:r})=>{const{handleDelete:p,handleQuantity:x,handleNewSale:y,handleDiscount:j,handleSalesLock:f,handlePayment:g,salesLock:b,selectedProduct:w,showMenu:v,setShowMenu:S,getDiscount:F,paymentMethod:L,setPaymentMethod:T,setShowCalendarModal:_}=r,[I,H]=s.useState(!1),[A,Q]=s.useState(new Date),{colorMode:W,setColorMode:z}=N("coreui-free-react-admin-template-theme");s.useEffect((()=>{const e=setInterval((()=>{Q(new Date)}),1e3);return()=>clearInterval(e)}),[]),s.useEffect((()=>{const e=e=>{"F11"===e.key&&(e.preventDefault(),$())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[I]);const $=()=>{if(!I)return document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),void H(!0);document.exitFullscreen&&document.exitFullscreen(),H(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-grow-1 text-uppercase","data-aos":"fade-in",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2 p-2 text-center",children:[e.jsxs("div",{onClick:()=>_(!0),children:[e.jsx(t,{icon:n,className:"me-1"}),A.toLocaleString("en-PH",{month:"long",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})]}),e.jsxs("div",{children:[e.jsxs(k,{children:[e.jsx(M,{caret:!1,children:"dark"===W?e.jsx(P,{icon:q,size:"lg"}):"auto"===W?e.jsx(P,{icon:C,size:"lg"}):e.jsx(P,{icon:R,size:"lg"})}),e.jsxs(E,{children:[e.jsxs(D,{active:"light"===W,className:"d-flex align-items-center",as:"button",type:"button",onClick:()=>z("light"),children:[e.jsx(P,{className:"me-2",icon:R,size:"lg"})," Light"]}),e.jsxs(D,{active:"dark"===W,className:"d-flex align-items-center",as:"button",type:"button",onClick:()=>z("dark"),children:[e.jsx(P,{className:"me-2",icon:q,size:"lg"})," Dark"]}),e.jsxs(D,{active:"auto"===W,className:"d-flex align-items-center",as:"button",type:"button",onClick:()=>z("auto"),children:[e.jsx(P,{className:"me-2",icon:C,size:"lg"})," Auto"]})]})]}),e.jsx(t,{className:"ms-2",icon:I?o:a,onClick:$,style:{cursor:"pointer"},title:I?"Exit Full Screen":"Full Screen"})]})]}),e.jsxs("div",{className:" d-flex justify-content-between align-items-center text-center",children:[e.jsxs("div",{className:" rounded py-4 m-1 d-flex flex-column align-items-center border border-2 "+(w.length>0?"bg-danger border-danger":"border-secondary"),onClick:e=>p("del"),style:{flex:1},children:[e.jsx(t,{icon:i,className:"mb-2",style:{width:"30px",height:"50px"}}),"Cancel"]}),e.jsxs("div",{className:"rounded py-4 m-1 d-flex flex-column align-items-center border border-2 border-secondary",onClick:x,style:{flex:1},children:[e.jsx(t,{icon:d,className:"mb-2",style:{width:"30px",height:"50px"}}),"Quantity"]}),e.jsxs("div",{className:"rounded py-4 m-1 d-flex flex-column align-items-center border border-2 border-secondary",onClick:y,style:{flex:1},children:[e.jsx(t,{icon:l,className:"mb-2",style:{width:"30px",height:"50px"}}),"New Sale"]})]}),e.jsx("small",{className:"ms-1",children:"Payments"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center text-center",children:[e.jsx("div",{className:"rounded py-2 m-1 d-flex flex-column align-items-center border border-2 "+("cash"===L?"bg-primary border-primary":"border-body-secondary"),onClick:()=>T("cash"),style:{flex:1},children:"Cash"}),e.jsx("div",{className:`rounded py-2 m-1 d-flex flex-column align-items-center border border-2 ${"credit"===L?"bg-primary border-primary":"border-secondary"}  bg-body-secondary`,style:{flex:1},children:"Credit Card"}),e.jsx("div",{className:`rounded py-2 m-1 d-flex flex-column align-items-center border border-2 ${"debit"===L?"bg-primary border-primary":"border-secondary"}  bg-body-secondary`,style:{flex:1},children:"Debit Card"})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 text-center",children:[e.jsx("div",{className:`rounded py-2 m-1 d-flex flex-column align-items-center border border-2 ${"check"===L?"bg-primary border-primary":"border-secondary"}  bg-body-secondary`,style:{flex:1},children:"Check"}),e.jsx("div",{className:"rounded py-2 m-1 d-flex flex-column align-items-center border border-2 border-secondary bg-body-secondary",style:{flex:1},children:"Gift Card"}),e.jsx("div",{className:"rounded py-2 m-1 d-flex flex-column align-items-center border border-2 border-secondary bg-body-secondary",style:{flex:1},children:"Voucher"})]}),w.length>0&&e.jsxs("div",{className:"ms-1",children:[w.length," Items selected"]})]}),e.jsxs("div",{className:"mt-auto text-uppercase","data-aos":"fade-in",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center text-center",children:[e.jsxs("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 "+(F()>0?"bg-primary border-primary":"border-secondary"),onClick:j,style:{flex:1},children:[e.jsx(t,{icon:c,style:{width:"30px",height:"50px"}})," ","Discount"]}),e.jsxs("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 "+(b?"bg-danger border-danger":"border-secondary"),onClick:f,style:{flex:1},children:[e.jsx(t,{icon:b?u:m,style:{width:"30px",height:"50px"}})," ",b?"Unlock":"Lock"]}),e.jsxs("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-success bg-success",onClick:g,style:{flex:1},children:[e.jsx("span",{className:"fs-2",children:"F10"}),"Payment"]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 text-center",children:[e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-secondary bg-secondary",style:{flex:1},children:"Refund"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-secondary bg-secondary",style:{flex:1},children:"Transfer"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-danger bg-danger",onClick:e=>p("void"),style:{flex:1},children:"Void"}),e.jsx("div",{className:"rounded py-3 m-1 d-flex flex-column align-items-center border border-2 border-secondary",onClick:()=>S(!v),style:{flex:1},children:e.jsx(t,{icon:h,style:{width:"25px",height:"25px"}})})]})]})]})};ne.propTypes={data:y.shape({handleDelete:y.func.isRequired,handleQuantity:y.func.isRequired,handleNewSale:y.func.isRequired,handleDiscount:y.func.isRequired,handleSalesLock:y.func.isRequired,handlePayment:y.func.isRequired,salesLock:y.bool.isRequired,selectedProduct:y.array.isRequired,showMenu:y.bool.isRequired,setShowMenu:y.func.isRequired,getDiscount:y.func.isRequired,paymentMethod:y.string.isRequired,setPaymentMethod:y.func.isRequired,setShowCalendarModal:y.func.isRequired}).isRequired};const oe=({data:r})=>{const{showMenu:n,setShowMenu:o,popupMenu:a,setPopupMenu:i,showPopupMenu:d,setShowPopupMenu:c}=r,u=B((e=>e.user)),m=X(),h=[{name:"Sales History",path:"/history",icon:l},{name:"Open Sales",path:"/open-sales",icon:l},{name:"Cash In/Out",path:"/cash-in-out",icon:l},{name:"End of Day",path:"/eod",icon:l},{name:"User Info",path:"/user-info",icon:l}];return s.useEffect((()=>{const e=e=>{console.log(e.key),"Escape"===e.key&&o(!1)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[]),e.jsxs("div",{className:"m-2","data-aos":"fade-in",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",style:{cursor:"pointer"},onClick:()=>o(!1),children:[e.jsxs("div",{className:"text-center py-3",onClick:()=>o(!1),children:[e.jsx(t,{icon:p,className:"my-auto me-3"}),e.jsx("span",{className:"text-uppercase",children:"Back"})]}),e.jsx("span",{onClick:e=>m("/logout"),children:"Logout"})]}),e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center mb-3 text-center",children:[e.jsx("div",{className:"rounded-pill bg-primary d-flex align-items-center justify-content-center fs-2",style:{width:"80px",height:"80px",color:"white"},children:(x=u.name,x?x.charAt(0).toUpperCase():"")}),e.jsx("h2",{className:"mt-2 mb-0",children:u.name}),e.jsx("p",{className:"mb-0",children:u.username})]}),e.jsx(F,{children:h.map(((s,r)=>e.jsx(L,{children:e.jsx(T,{children:e.jsxs("span",{className:"border p-3 rounded",style:{display:"flex",alignItems:"center",gap:"8px"},onClick:()=>{i(s.path),o(!1),c(!0)},children:[e.jsx(t,{icon:s.icon,className:"my-auto"}),e.jsx("span",{children:s.name})]})})},r)))})]});var x};oe.propTypes={data:y.shape({showMenu:y.bool.isRequired,setShowMenu:y.func.isRequired,popupMenu:y.string.isRequired,setPopupMenu:y.func.isRequired,showPopupMenu:y.bool.isRequired,setShowPopupMenu:y.func.isRequired}).isRequired};const ae=({data:t})=>{const{popupMenu:r,setPopupMenu:n,showPopupMenu:o,setShowPopupMenu:a}=t,[i,d]=s.useState([]),[l,c]=s.useState(1),[u,m]=s.useState(0);return s.useEffect((()=>{o&&(async()=>{try{axios.get("/sales-history").then((e=>{d(e.data.data),m(e.data.totalPages),c(e.data.currentPage)})).catch((e=>{console.error("Error fetching sales history:",e)}))}catch(e){console.error("Error fetching sales history:",e)}})()}),[]),e.jsx(e.Fragment,{children:e.jsxs(j,{fullscreen:!0,alignment:"center",scrollable:!0,visible:o,onClose:()=>a(!1),"aria-labelledby":"Help Modal",children:[e.jsx(f,{className:"border-0"}),e.jsxs(b,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{children:"Your Today's Sales History"}),e.jsx(v,{color:"primary",children:"Export"})]}),0===i.length?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("h3",{children:"Loading sales..."})}):e.jsxs(e.Fragment,{children:[e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx(I,{children:e.jsxs(H,{children:[e.jsx(A,{scope:"col",children:"#"}),e.jsx(A,{scope:"col",children:"Amount"}),e.jsx(A,{scope:"col",children:"Discount"}),e.jsx(A,{scope:"col",children:"Payment"}),e.jsx(A,{scope:"col",children:"Reference Number"}),e.jsx(A,{scope:"col"}),e.jsx(A,{scope:"col"})]})}),e.jsx(Q,{children:i.map(((s,t)=>e.jsxs(H,{children:[e.jsx(W,{children:s.id}),e.jsx(W,{children:s.total}),e.jsx(W,{children:s.total_discount.toLocaleString()}),e.jsx(W,{children:s.mode_of_payment}),e.jsx(W,{children:s.reference_number}),e.jsx(W,{children:U(s.created_at)}),e.jsx(W,{children:e.jsx(v,{color:"primary",size:"sm",children:"Print"})})]},s.id)))})]}),e.jsx(K,{currentPage:l,setCurrentPage:c,totalPages:u,setTotalPages:m})]})]})]})})};ae.propTypes={data:y.shape({popupMenu:y.string.isRequired,setPopupMenu:y.func.isRequired,showPopupMenu:y.bool.isRequired,setShowPopupMenu:y.func.isRequired}).isRequired};const ie=({data:s})=>{const{popupMenu:t,setPopupMenu:r,showPopupMenu:n,setShowPopupMenu:o}=s;return e.jsx(e.Fragment,{children:e.jsxs(j,{alignment:"center",scrollable:!0,visible:n,onClose:()=>o(!1),"aria-labelledby":"Help Modal",children:[e.jsx(f,{className:"border-0",children:e.jsx(g,{className:"text-center",children:"End of Day"})}),e.jsxs(b,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"d-block",children:"Are you sure you want to end the day?"}),e.jsx("span",{children:"All sales will be finalized and no further transactions can be made."})]}),e.jsx(S,{className:"mt-3",type:"text",placeholder:"Enter the cash drawer amount","aria-label":"Cash drawer amount"}),e.jsx(v,{className:"mt-3",color:"primary",onClick:()=>{o(!1),r("")},children:"Confirm End of Day"})]})]})})};ie.propTypes={data:y.shape({popupMenu:y.string.isRequired,setPopupMenu:y.func.isRequired,showPopupMenu:y.bool.isRequired,setShowPopupMenu:y.func.isRequired}).isRequired};const de=()=>{const[t,r]=s.useState([]),[n,o]=s.useState([]),[a,i]=s.useState(null),[d,l]=s.useState(""),[c,u]=s.useState(!1),[m,h]=s.useState(!1),[p,y]=s.useState(!1),[j,f]=s.useState(!1),[g,b]=s.useState(!1),[w,v]=s.useState(!1),[N,k]=s.useState(!1),[M,P]=s.useState(!1),[q,C]=s.useState("cash"),[R,E]=s.useState(!1),[D,F]=s.useState(0),[L,T]=s.useState(!1),[J,B]=s.useState(null),[X,K]=s.useState(!1),[U,de]=s.useState(""),[le,ce]=s.useState(!1),ue=()=>t.filter((e=>"discount"!==e.id&&!e.deleted)).reduce(((e,s)=>e+s.sale_price*(1-s.discount/100)*s.quantity),0),me=()=>t.filter((e=>!e.deleted)).reduce(((e,s)=>{const t=s.sale_price*(1-s.discount/100);return e+(s.taxes?t*s.taxes/100:0)*s.quantity}),0).toFixed(2),he=()=>(parseFloat(ue())+parseFloat(me()))*(1-parseFloat(D)/100),pe=(e,s,t=0)=>e*(1-t/100)*s,xe=(e,s=0)=>e*(1-s/100),ye=e=>{const s=[{condition:"F1"===e.key,action:()=>k(!0)},{condition:"F2"===e.key,action:fe},{condition:"F4"===e.key,action:je},{condition:"F10"===e.key,action:be},{condition:"Delete"===e.key,action:ge},{condition:e.ctrlKey&&"h"===e.key.toLowerCase(),action:()=>P(!0)}];for(const{condition:t,action:r}of s)if(t){e.preventDefault(),u(!1),h(!1),y(!1),f(!1),b(!1),v(!1),k(!1),P(!1),r();break}};s.useEffect((()=>{const e=e=>{if(L)return e.preventDefault(),e.returnValue="",""};return window.addEventListener("beforeunload",e),window.addEventListener("keydown",ye),()=>{window.removeEventListener("keydown",ye),window.removeEventListener("beforeunload",e)}}),[L]),s.useEffect((()=>{let e;(async()=>{axios.get("/sales-lock").then((e=>{if(e.data.error)return x.error(e.data.error);e.data.length>0?(i(!0),r(JSON.parse(e.data))):i(!1)})).catch((e=>{console.error("Error fetching sales lock:",e)}))})();const s=()=>{K(!1),clearTimeout(e),e=setTimeout((()=>{K(!0)}),6e4)};return e=setTimeout((()=>{K(!0)}),6e4),window.addEventListener("mousemove",s),window.addEventListener("keydown",s),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("keydown",s),clearTimeout(e)}}),[]);const je=()=>a?x.error("Sales locked"):0===n.length?x.error("Select a product"):void h(!0),fe=()=>a?x.error("Sales locked"):0===t.length?x.error("No products in cart"):void y(!0),ge=e=>a?x.error("Sales locked"):0===n.length?x.error("Select a product"):(u(!0),void B(e)),be=()=>a?x.error("Sales locked"):0===t.length?x.error("No products in cart"):void v(!0);return null===a?e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(z,{color:"primary"})}):e.jsxs("div",{className:"d-flex flex-column",style:{height:"100vh",width:"99.3%",position:"relative"},children:[X&&e.jsx("div",{style:{zIndex:9e3,position:"fixed",top:0,left:0,height:"100vh",width:"100vw",background:"#fff"},children:e.jsx($,{src:"/images/banner.jpg",className:"img-fluid",alt:"Banner",style:{width:"100vw",height:"100vh",objectFit:"cover"}})}),"/history"===U&&e.jsx(ae,{data:{showPopupMenu:le,setShowPopupMenu:ce}}),"/eod"===U&&e.jsx(ie,{data:{showPopupMenu:le,setShowPopupMenu:ce}}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:0,pointerEvents:"none",color:"#000",letterSpacing:"0.1em",userSelect:"none",whiteSpace:"nowrap",textAlign:"center"},children:[e.jsx("span",{style:{fontSize:"4vw",fontWeight:700,opacity:.08},children:"Project POS"}),e.jsx("span",{className:"d-block",style:{opacity:.2},children:"https://mrepol742.github.io"})]}),e.jsx(V,{data:{showDeleteModal:c,setShowDeleteModal:u,products:t,setProducts:r,selectedProduct:n,setSelectedProduct:o,deleteMode:J}}),e.jsx(Y,{data:{showQuantityModal:m,setShowQuantityModal:h,products:t,setProducts:r,selectedProduct:n,setSelectedProduct:o}}),e.jsx(Z,{data:{showDiscountModal:p,setShowDiscountModal:y,products:t,setProducts:r,selectedProduct:n,setSelectedProduct:o,discount:D,setDiscount:F}}),e.jsx(ee,{data:{showPaymentModal:w,setShowPaymentModal:v,products:t,setProducts:r,selectedProduct:n,setSelectedProduct:o,getTotal:he,paymentMethod:q,setPaymentMethod:C,discount:D,setDiscount:F}}),e.jsx(se,{data:{showSearchModal:g,setShowSearchModal:b,products:t,setProducts:r,searchQuery:d}}),e.jsx(te,{data:{showCalendarModal:N,setShowCalendarModal:k}}),e.jsx(re,{data:{showHelpModal:M,setShowHelpModal:P}}),e.jsxs(O,{className:"flex-grow-1 overflow-hidden",children:[e.jsxs(G,{className:"d-flex flex-column h-100 pe-0",children:[e.jsx(S,{className:"rounded-0 py-3 border-0 border-bottom",type:"search",placeholder:"Search product by name or barcode","aria-label":"Search",value:d,onChange:e=>{l(e.target.value)},autoFocus:!0,onFocus:e=>{e.target.select(),e.target.setSelectionRange(0,e.target.value.length)},onKeyDown:e=>{"Enter"===e.key&&((e=>{if(a)return x.error("Sales locked");const s=e.target.value;if(s.includes(" "))return l(s),b(!0);if(t.find((e=>e.barcode&&e.barcode.toLowerCase()===s&&0===e.discount)))return r((e=>e.map((e=>e.barcode&&e.barcode.toLowerCase()===s?{...e,quantity:e.quantity+1}:e)))),void T(!0);axios.get(`/products/${s}`).then((e=>{if(e.data.error)return x.error(e.data.error);if(!e.data.id)return x.error("Product not found");const s=e.data;r((e=>e.find((e=>e.id===s.id&&0===e.discount))?e.map((e=>e.id===s.id?{...e,quantity:e.quantity+1,discount:0}:e)):[...e,{...s,quantity:1,discount:0,date:Date.now()}])),T(!0)})).catch((e=>{console.error("Error searching products:",e)}))})(e),e.target.value.includes(" ")||(e.target.value="",l("")))}}),e.jsx("div",{className:"flex-grow-1 overflow-auto",style:{minHeight:0},children:e.jsxs(_,{hover:!0,responsive:!0,children:[e.jsx(I,{children:e.jsxs(H,{children:[e.jsx(A,{scope:"col",className:"text-uppercase",style:{width:50,maxWidth:80},children:"QTY"}),e.jsx(A,{scope:"col",className:"text-uppercase",style:{minWidth:180},children:"Item"}),e.jsx(A,{scope:"col",className:"text-uppercase text-end",style:{width:100,maxWidth:120},children:"Price"}),e.jsx(A,{scope:"col",className:"text-uppercase text-end",style:{width:110,maxWidth:130},children:"Total"})]})}),0!==t.length&&e.jsx(Q,{children:t.map(((s,t)=>{const r=s.taxes?s.sale_price+s.sale_price*s.taxes/100:s.sale_price;return e.jsxs(H,{active:n.includes(s.date),onClick:()=>(e=>{if(n.includes(e))return o(n.filter((s=>s!==e)));o([...n,e])})(s.date),children:[e.jsx(W,{className:`${s.deleted&&"text-danger"}`,style:{width:50,maxWidth:80},children:s.quantity}),e.jsxs(W,{style:{minWidth:180},children:[e.jsx("span",{className:`${s.deleted&&"text-danger"}`,children:s.name}),e.jsx("span",{className:(s.deleted?"text-danger":"text-muted")+" d-block",style:{fontSize:"0.7em"},children:s.barcode})]}),e.jsxs(W,{className:`${s.deleted&&"text-danger"} text-end`,style:{width:100,maxWidth:120},children:[xe(r,s.discount).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),s.discount>0&&e.jsx("div",{className:"d-block text-muted text-decoration-line-through",style:{fontSize:"0.7em"},children:xe(r,0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsx(W,{className:`${s.deleted&&"text-danger"} text-end`,style:{width:110,maxWidth:130},children:pe(r,s.quantity,s.discount).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]},t)}))})]})}),e.jsxs("div",{className:"bg-body-secondary p-3 m-3 rounded mt-auto",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:ue().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),D>0&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:[D,"%"]})]}),e.jsxs("div",{className:"d-flex justify-content-between  border-bottom border-secondary pb-2",children:[e.jsx("span",{children:"Tax:"}),e.jsx("span",{children:me().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-2",children:[e.jsx("strong",{children:"Total:"}),e.jsx("strong",{children:he().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})})]})]})]}),e.jsx(G,{lg:5,xl:3,className:"d-flex flex-column border-start border-2 border-secondary h-100",children:R?e.jsx(oe,{data:{showMenu:R,setShowMenu:E,popupMenu:U,setPopupMenu:de,showPopupMenu:le,setShowPopupMenu:ce}}):e.jsx(ne,{data:{handleDelete:ge,handleQuantity:je,handleNewSale:()=>a?x.error("Sales locked"):0===t.length?x.error("No products in cart"):(r([]),void o([])),handleDiscount:fe,handleSalesLock:async()=>{if(0===t.length)return x.error("No products in cart");axios.post("/sales-lock",{products:a?"[]":JSON.stringify(t),mode:!a}).then((e=>{if(e.data.error)return x.error(e.data.error);x.success(a?"Sales unlocked successfully":"Sales locked successfully"),i(!a)})).catch((e=>{console.error("Error fetching sales lock:",e)}))},handlePayment:be,salesLock:a,selectedProduct:n,showMenu:R,setShowMenu:E,getDiscount:()=>t.reduce(((e,s)=>e+(s.discount||0)),0),paymentMethod:q,setPaymentMethod:C,setShowCalendarModal:k}})})]})]})};export{de as default};
